<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.4.xsd">

    <changeSet id="eventhub-tables/v1/03-04-2025/1" author="Shabakhov_Eset">
        <sql>
            <![CDATA[
            CREATE TABLE public.user(
                id bigserial primary key,
                role role_type NOT NULL,
                email varchar NOT NULL,
                username varchar NOT NULL UNIQUE,
                display_name varchar NOT NULL,
                password varchar NOT NULL,
                is_active boolean NOT NULL
            );
            ]]>
        </sql>
    </changeSet>
    <changeSet id="eventhub-tables/v1/03-04-2025/2" author="Shabakhov_Eset">
        <sql>
            <![CDATA[
            CREATE TABLE public.organizer(
                id bigserial primary key,
                name varchar,
                description varchar,
                industry varchar,
                address varchar,
                is_accredited boolean,
                CONSTRAINT fk_organizer_user
                    FOREIGN KEY (id)
                    REFERENCES public.user(id)
                    ON DELETE RESTRICT
                    ON UPDATE CASCADE
            );
            ]]>
        </sql>
    </changeSet>
    <changeSet id="eventhub-tables/v1/03-04-2025/3" author="Shabakhov_Eset">
        <sql>
            <![CDATA[
            CREATE TABLE public.member(
                id bigserial primary key,
                last_name varchar,
                first_name varchar,
                patronymic varchar,
                birth_date varchar,
                birth_city varchar,
                privacy privacy_type default 'ONLY_FRIENDS',
                CONSTRAINT fk_member_user
                    FOREIGN KEY (id)
                    REFERENCES public.user(id)
                    ON DELETE RESTRICT
                    ON UPDATE CASCADE
            );
            ]]>
        </sql>
    </changeSet>
    <changeSet id="eventhub-tables/v1/03-04-2025/4" author="Shabakhov_Eset">
        <sql>
            <![CDATA[
            CREATE TABLE public.moderator(
                id bigserial primary key,
                is_admin boolean,
                CONSTRAINT fk_moderator_user
                    FOREIGN KEY (id)
                    REFERENCES public.user(id)
                    ON DELETE RESTRICT
                    ON UPDATE CASCADE
            );
            ]]>
        </sql>
    </changeSet>
    <changeSet id="eventhub-tables/v1/05-04-2025/1" author="Timokhov_Evgeniy">
        <sql>
            <![CDATA[
            CREATE TABLE public.tag(
                id bigserial primary key,
                name varchar NOT NULL
            );
            ]]>
        </sql>
    </changeSet>
    <changeSet id="eventhub-tables/v1/05-04-2025/2" author="Timokhov_Evgeniy">
        <sql>
            <![CDATA[
            CREATE TABLE public.event(
                                       id bigserial primary key,
                                       title varchar NOT NULL,
                                       description varchar NOT NULL,
                                       format format_type NOT NULL,
                                       start_date_time timestamp NOT NULL,
                                       end_date_time timestamp NOT NULL,
                                       location varchar NOT NULL,
                                       latitude numeric,
                                       longitude numeric,
                                       organizer_id bigserial NOT NULL,
                                       CONSTRAINT fk_event_organizer
                                           FOREIGN KEY (organizer_id)
                                           REFERENCES public.organizer(id)
                                           ON DELETE RESTRICT
                                           ON UPDATE CASCADE
            );
            ]]>
        </sql>
    </changeSet>
</databaseChangeLog>